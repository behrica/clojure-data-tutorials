
---
format:
  html: {toc: true, toc-depth: 4, theme: spacelab, output-file: ml.html}
highlight-style: solarized
code-block-background: true
include-in-header: {text: '<link rel = "icon" href = "data:," />'}

---
<style>.table {
    overflow-y: scroll;
}
</style><style>.printedClojure .sourceCode {
  background-color: transparent;
  border-style: none;
}
</style>
<script src="ml_files/md-default0.js" type="text/javascript"></script><script src="ml_files/md-default1.js" type="text/javascript"></script>
<table><tr><td>This is part of the Scicloj <a href="https://scicloj.github.io/clojure-data-scrapbook/">Clojure Data Scrapbook</a>.</td><a href="https://scicloj.github.io/clojure-data-scrapbook/"><img align="left" alt="SciCloj logo" src="https://scicloj.github.io/sci-cloj-logo-transparent.png" width="40" /></a></tr></table>


# Machine learning - DRAFT


<div class="sourceClojure">
```clojure
(ns ml
  (:require [scicloj.ml.core :as ml]
            [scicloj.ml.metamorph :as mm]
            [scicloj.ml.dataset :refer [dataset add-column]]
            [scicloj.ml.dataset :as ds]
            [fastmath.stats]
            [tablecloth.api :as tc]
            [scicloj.noj.v1.datasets :as datasets]
            [scicloj.kindly.v4.kind :as kind]))
```
</div>



## Linear regression
We will explore the Iris dataset:


<div class="sourceClojure">
```clojure
(tc/head datasets/iris)
```
</div>


_unnamed [5 5]:

| :sepal-length | :sepal-width | :petal-length | :petal-width | :species |
|--------------:|-------------:|--------------:|-------------:|----------|
|           5.1 |          3.5 |           1.4 |          0.2 |   setosa |
|           4.9 |          3.0 |           1.4 |          0.2 |   setosa |
|           4.7 |          3.2 |           1.3 |          0.2 |   setosa |
|           4.6 |          3.1 |           1.5 |          0.2 |   setosa |
|           5.0 |          3.6 |           1.4 |          0.2 |   setosa |



A Metamorph pipeline for linear regression:


<div class="sourceClojure">
```clojure
(def additive-pipeline
  (ml/pipeline
   (mm/set-inference-target :sepal-length)
   (mm/drop-columns [:species])
   {:metamorph/id :model}
   (mm/model {:model-type :smile.regression/ordinary-least-square})))
```
</div>


Training and evaluating the pipeline on various subsets:


<div class="sourceClojure">
```clojure
(def evaluations
  (ml/evaluate-pipelines
   [additive-pipeline]
   (ds/split->seq datasets/iris :holdout)
   ml/rmse
   :loss
   {:other-metrices [{:name :r2
                      :metric-fn fastmath.stats/r2-determination}]}))
```
</div>


Printing one of the trained models (note that the Smile regression model is recognized by Kindly and printed correctly):


<div class="sourceClojure">
```clojure
(-> evaluations
    flatten
    first
    :fit-ctx
    :model
    ml/thaw-model)
```
</div>



<div class="printedClojure">
```clojure
Linear Model:

Residuals:
       Min          1Q      Median          3Q         Max
   -0.7900     -0.2237      0.0394      0.2235      0.8037

Coefficients:
                  Estimate Std. Error    t value   Pr(>|t|)
Intercept           1.7690     0.3120     5.6689     0.0000 ***
sepal-width         0.6801     0.0844     8.0599     0.0000 ***
petal-length        0.7043     0.0664    10.6014     0.0000 ***
petal-width        -0.5256     0.1508    -3.4858     0.0007 ***
---------------------------------------------------------------------
Significance codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.3057 on 96 degrees of freedom
Multiple R-squared: 0.8690,    Adjusted R-squared: 0.8649
F-statistic: 212.1968 on 4 and 96 DF,  p-value: 3.179e-42

```
</div>


<div style="background-color:grey;height:2px;width:100%;"></div>

<div><pre><small><small>source: <a href="https://github.com/scicloj/clojure-data-scrapbook/blob/main/projects/noj/notebooks/ml.clj">projects/noj/notebooks/ml.clj</a></small></small></pre></div>