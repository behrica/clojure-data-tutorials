
---
format:
  html:
    toc: true
    toc-depth: 4
    theme: [cosmo, notebooks/custom.scss]
    output-file: index.html
code-block-background: true
include-in-header: {text: '<link rel = "icon" href = "data:," />'}
fontsize: 0.8em

---
<style></style><style>.printedClojure .sourceCode {
  background-color: transparent;
  border-style: none;
}
</style><style>.clay-limit-image-width .clay-image {max-width: 100%}
</style>
<script src="index_files/md-default12.js" type="text/javascript"></script><script src="index_files/md-default13.js" type="text/javascript"></script><script src="index_files/vega14.js" type="text/javascript"></script><script src="index_files/vega15.js" type="text/javascript"></script><script src="index_files/vega16.js" type="text/javascript"></script>

```{=html}
<table><tr><td>This is part of the Scicloj <a href="https://scicloj.github.io/clojure-data-scrapbook/">Clojure Data Scrapbook</a>.</td><a href="https://scicloj.github.io/clojure-data-scrapbook/"><img align="left" alt="SciCloj logo" src="https://scicloj.github.io/sci-cloj-logo-transparent.png" width="40" /></a></tr></table>
```



# Chicago bikes - DRAFT

This page will be updated soon.


## Data sources:
- [Cyclistic bike share - Kaggle](https://www.kaggle.com/datasets/evangower/cyclistic-bike-share)
- [Cyclistic bike share - 2023 update - Kaggle](https://www.kaggle.com/datasets/godofoutcasts/cyclistic-bike-share-2023)
- [Chicago neighborhoods geojson by @blackmad](https://github.com/blackmad/neighborhoods/blob/master/chicago.geojson)



## Setup


::: {.sourceClojure}
```clojure
(ns index
  (:require [tablecloth.api :as tc]
            [clojure.math :as math]
            [tech.v3.datatype.datetime :as datetime]
            [tech.v3.datatype.functional :as fun]
            [clojure.string :as str]
            [scicloj.noj.v1.vis.hanami :as hanami]
            [aerial.hanami.templates :as ht]
            [fastmath-clustering.core :as clustering]
            [geo
             [geohash :as geohash]
             [jts :as jts]
             [spatial :as spatial]
             [io :as geoio]
             [crs :as crs]]
            [scicloj.kindly.v4.kind :as kind]
            [scicloj.kindly.v4.api :as kindly])
  (:import (org.locationtech.jts.geom Geometry Point Polygon Coordinate)
           (org.locationtech.jts.geom.prep PreparedGeometry
                                           PreparedLineString
                                           PreparedPolygon
                                           PreparedGeometryFactory)))
```
:::



## Reading the data


::: {.sourceClojure}
```clojure
(defonce raw-trips
  (-> "data/kaggle-cyclistic/202304_divvy_tripdata.csv.gz"
      (tc/dataset {:parser-fn {"started_at" [:local-date-time "yyyy-MM-dd HH:mm:ss"]
                               "ended_at" [:local-date-time "yyyy-MM-dd HH:mm:ss"]}
                   :key-fn keyword})))
```
:::



## Coordinate conversions


The datasets uses the [WGS84](https://en.wikipedia.org/wiki/World_Geodetic_System)
coordinate system, representing latitude and longitued over the globe.
[EPSG:4326](https://epsg.io/4326)

For metric computations (e.g., k-means clustering),
we need to convert them to a coordinate system
which is locally correct in terms of distances in a region around Chicago:
NAD83 / Illinois East
[EPSG:26971](https://epsg.io/26971-1742)

::: {.clay-dataset}
United States (USA) - Oregon and Washington. [1 3]:

|   Center coordinates |                             Projected bounds |                   WGS84 bounds |
|----------------------|----------------------------------------------|--------------------------------|
| [316133.6 345590.74] | [[216692.35 43649.23] [416809.98 648476.24]] | [[-89.27 37.06] [-87.02 42.5]] |


:::



::: {.sourceClojure}
```clojure
(def crs-transform
  (geo.crs/create-transform (geo.crs/create-crs 4326)
                            (geo.crs/create-crs 26971)))
```
:::



::: {.sourceClojure}
```clojure
(defn wgs84->Chicago
  "Transforming latitude-longitude coordinates
  to local Euclidean coordinates around Seattle."
  [geometry]
  (geo.jts/transform-geom geometry crs-transform))
```
:::



::: {.sourceClojure}
```clojure
(defn lat-lng->local-coords [lat lng]
  (-> (geo.jts/coordinate lat lng)
      geo.jts/point
      wgs84->Chicago
      geo.jts/coord
      ((fn [^Coordinate coord]
         [(.getX coord)
          (.getY coord)]))))
```
:::


Example:


::: {.sourceClojure}
```clojure
(delay
  (lat-lng->local-coords -89.27 37.06))
```
:::



::: {.printedClojure}
```clojure
[216692.34803057025 44059.50658557552]

```
:::



## Preprocessing


::: {.sourceClojure}
```clojure
(def coord-colnames
  [:start_lat :start_lng :end_lat :end_lng])
```
:::



::: {.sourceClojure}
```clojure
(def processed-trips
  (-> raw-trips
      (tc/add-column :hour (fn [trips]
                             (->> trips
                                  :started_at
                                  (datetime/long-temporal-field :hours))))
      (tc/select-rows (fn [row]
                        (->> coord-colnames
                             (map row)
                             (every? some?))))
      (tc/map-columns :start-local-coords [:start_lat :start_lng] lat-lng->local-coords)
      (tc/map-columns :end-local-coords [:end_lat :end_lng] lat-lng->local-coords)
      (tc/map-columns :start-local-x [:start-local-coords] first)
      (tc/map-columns :start-local-y [:start-local-coords] second)
      (tc/map-columns :end-local-x [:end-local-coords] first)
      (tc/map-columns :end-local-y [:end-local-coords] second)))
```
:::



## Comparing Eucledian (L2) distances in global and local coordinates


::: {.sourceClojure}
```clojure
(-> processed-trips
    (tc/add-column :local-distance #(fun/sqrt
                                     (fun/+ (fun/sq (fun/- (:start-local-x %)
                                                           (:end-local-x %)))
                                            (fun/sq (fun/- (:start-local-y %)
                                                           (:end-local-y %)))))))
```
:::


::: {.clay-dataset}
data/kaggle-cyclistic/202304_divvy_tripdata.csv.gz [426155 21]:

|         :ride_id | :rideable_type |         :started_at |           :ended_at |        :start_station_name | :start_station_id |         :end_station_name | :end_station_id |  :start_lat |   :start_lng |    :end_lat |     :end_lng | :member_casual | :hour |                        :start-local-coords |                          :end-local-coords |  :start-local-x |  :start-local-y |    :end-local-x |    :end-local-y | :local-distance |
|------------------|----------------|---------------------|---------------------|----------------------------|-------------------|---------------------------|-----------------|------------:|-------------:|------------:|-------------:|----------------|------:|--------------------------------------------|--------------------------------------------|----------------:|----------------:|----------------:|----------------:|----------------:|
| 8FE8F7D9C10E88C7 |  electric_bike | 2023-04-02T08:37:28 | 2023-04-02T08:41:37 |                            |                   |                           |                 | 41.80000000 | -87.60000000 | 41.79000000 | -87.60000000 |         member |     8 |  [506107.9325773436 -1.4235352994997954E7] | [506137.42192310654 -1.4235316240199374E7] | 506107.93257734 | -1.42353530E+07 | 506137.42192311 | -1.42353162E+07 |     47.12257137 |
| 34E4ED3ADF1D821B |  electric_bike | 2023-04-19T11:29:02 | 2023-04-19T11:52:12 |                            |                   |                           |                 | 41.87000000 | -87.65000000 | 41.93000000 | -87.68000000 |         member |    11 |  [501519.8754807859 -1.4231908162239876E7] |  [498721.7934556093 -1.4229901392452776E7] | 501519.87548079 | -1.42319082E+07 | 498721.79345561 | -1.42299014E+07 |   3443.31061597 |
| 5296BF07A2F77CB5 |  electric_bike | 2023-04-19T08:41:22 | 2023-04-19T08:43:22 |                            |                   |                           |                 | 41.93000000 | -87.66000000 | 41.93000000 | -87.66000000 |         member |     8 | [500470.98093146156 -1.4231382653142933E7] | [500470.98093146156 -1.4231382653142933E7] | 500470.98093146 | -1.42313827E+07 | 500470.98093146 | -1.42313827E+07 |      0.00000000 |
| 40759916B76D5D52 |  electric_bike | 2023-04-19T13:31:30 | 2023-04-19T13:35:09 |                            |                   |                           |                 | 41.92000000 | -87.65000000 | 41.91000000 | -87.65000000 |         member |    13 |  [501374.92347210384 -1.423208764589309E7] |  [501403.9254779691 -1.4232051758343631E7] | 501374.92347210 | -1.42320876E+07 | 501403.92547797 | -1.42320518E+07 |     46.14144070 |
| 77A96F460101AC63 |  electric_bike | 2023-04-19T12:05:36 | 2023-04-19T12:10:26 |                            |                   |                           |                 | 41.91000000 | -87.65000000 | 41.91000000 | -87.63000000 |         member |    12 |  [501403.9254779691 -1.4232051758343631E7] |  [503154.9287078667 -1.4233533354956321E7] | 501403.92547797 | -1.42320518E+07 | 503154.92870787 | -1.42335334E+07 |   2293.71768835 |
| 8D6A2328E19DC168 |  electric_bike | 2023-04-19T12:17:34 | 2023-04-19T12:21:38 |                            |                   |                           |                 | 41.91000000 | -87.63000000 | 41.92000000 | -87.65000000 |         member |    12 |  [503154.9287078667 -1.4233533354956321E7] |  [501374.92347210384 -1.423208764589309E7] | 503154.92870787 | -1.42335334E+07 | 501374.92347210 | -1.42320876E+07 |   2293.14049610 |
| C97BBA66E07889F9 |  electric_bike | 2023-04-19T09:35:48 |    2023-04-19T09:45 |                            |                   |                           |                 | 41.93000000 | -87.66000000 | 41.91000000 | -87.65000000 |         member |     9 | [500470.98093146156 -1.4231382653142933E7] |  [501403.9254779691 -1.4232051758343631E7] | 500470.98093146 | -1.42313827E+07 | 501403.92547797 | -1.42320518E+07 |   1148.07983018 |
| 6687AD4C575FF734 |  electric_bike | 2023-04-11T16:13:43 | 2023-04-11T16:18:41 |                            |                   |                           |                 | 42.00000000 | -87.66000000 | 41.99000000 | -87.66000000 |         member |    16 |  [500268.5489835212 -1.4231632572144713E7] | [500297.48516240803 -1.4231596883177325E7] | 500268.54898352 | -1.42316326E+07 | 500297.48516241 | -1.42315969E+07 |     45.94567272 |
| A8FA4F73B22BC11F |  electric_bike | 2023-04-11T16:29:24 | 2023-04-11T16:40:23 |                            |                   |                           |                 | 41.99000000 | -87.66000000 | 42.00000000 | -87.66000000 |         member |    16 | [500297.48516240803 -1.4231596883177325E7] |  [500268.5489835212 -1.4231632572144713E7] | 500297.48516241 | -1.42315969E+07 | 500268.54898352 | -1.42316326E+07 |     45.94567272 |
| 81E158FE63D99994 |  electric_bike | 2023-04-19T17:35:40 | 2023-04-19T17:36:11 |                            |                   |                           |                 | 41.88000000 | -87.65000000 | 41.88000000 | -87.65000000 |         member |    17 |   [501490.896685202 -1.4231944068150206E7] |   [501490.896685202 -1.4231944068150206E7] | 501490.89668520 | -1.42319441E+07 | 501490.89668520 | -1.42319441E+07 |      0.00000000 |
|              ... |            ... |                 ... |                 ... |                        ... |               ... |                       ... |             ... |         ... |          ... |         ... |          ... |            ... |   ... |                                        ... |                                        ... |             ... |             ... |             ... |             ... |             ... |
| BAE25DBA0CD0DF40 |  electric_bike | 2023-04-14T07:12:34 | 2023-04-14T07:42:07 | Richmond St & Diversey Ave |             15645 | Clark St & Ida B Wells Dr |    TA1305000009 | 41.93186915 | -87.70120764 | 41.87593267 | -87.63058454 |         member |     7 |  [496862.65843494714 -1.422833795268237E7] | [503203.23756304523 -1.4233366677138694E7] | 496862.65843495 | -1.42283380E+07 | 503203.23756305 | -1.42333667E+07 |   8092.65181120 |
| 5A98F86A573AAB2C |  electric_bike | 2023-04-24T07:27:02 | 2023-04-24T07:58:22 | Richmond St & Diversey Ave |             15645 | Clark St & Ida B Wells Dr |    TA1305000009 | 41.93198085 | -87.70128024 | 41.87593267 | -87.63058454 |         member |     7 |  [496855.9967031725 -1.4228332970829802E7] | [503203.23756304523 -1.4233366677138694E7] | 496855.99670317 | -1.42283330E+07 | 503203.23756305 | -1.42333667E+07 |   8100.96696311 |
| 92B02F2FBDC1FB9F |   classic_bike | 2023-04-12T08:16:48 | 2023-04-12T08:40:08 |     Michigan Ave & Lake St |      TA1305000011 |        May St & Taylor St |           13160 | 41.88602200 | -87.62439800 | 41.86948210 | -87.65548640 |         member |     8 |  [503715.7528127164 -1.4233861403126204E7] | [501040.95186117536 -1.4231500346004825E7] | 503715.75281272 | -1.42338614E+07 | 501040.95186118 | -1.42315003E+07 |   3567.79355636 |
| 119A6C53607EAA4A |  electric_bike | 2023-04-28T07:24:54 | 2023-04-28T07:53:44 | Richmond St & Diversey Ave |             15645 | Clark St & Ida B Wells Dr |    TA1305000009 | 41.93190396 | -87.70125461 | 41.87593267 | -87.63058454 |         member |     7 |  [496858.4550664372 -1.4228334598338569E7] | [503203.23756304523 -1.4233366677138694E7] | 496858.45506644 | -1.42283346E+07 | 503203.23756305 | -1.42333667E+07 |   8098.02951217 |
| 9BCF1E8BA027EAFA |  electric_bike | 2023-04-21T07:15:06 | 2023-04-21T07:41:45 | Richmond St & Diversey Ave |             15645 | Clark St & Ida B Wells Dr |    TA1305000009 | 41.93193305 | -87.70126295 | 41.87593267 | -87.63058454 |         member |     7 |  [496857.6431128598 -1.4228334082633112E7] | [503203.23756304523 -1.4233366677138694E7] | 496857.64311286 | -1.42283341E+07 | 503203.23756305 | -1.42333667E+07 |   8098.98613308 |
| A17D800CE963661A |   classic_bike | 2023-04-11T15:46:42 | 2023-04-11T15:50:03 |     Michigan Ave & Lake St |      TA1305000011 |    Clark St & Randolph St |    TA1305000030 | 41.88602200 | -87.62439800 | 41.88457623 | -87.63188991 |         member |    15 |  [503715.7528127164 -1.4233861403126204E7] |  [503063.6502967095 -1.4233301315734675E7] | 503715.75281272 | -1.42338614E+07 | 503063.65029671 | -1.42333013E+07 |    859.61362107 |
| 8B441A6C436E9900 |   classic_bike | 2023-04-29T21:20:21 | 2023-04-29T21:30:19 |       Halsted St & 18th St |             13099 | Blue Island Ave & 18th St |           13135 | 41.85750568 | -87.64599144 | 41.85755600 | -87.66153500 |         casual |    21 |  [501907.1861189178 -1.4232159853149524E7] | [500545.77541704464 -1.4231010242258897E7] | 501907.18611892 | -1.42321599E+07 | 500545.77541704 | -1.42310102E+07 |   1781.86539868 |
| 3980D64BE11540F1 |   classic_bike | 2023-04-24T09:16:05 | 2023-04-24T09:22:27 |       Halsted St & 18th St |             13099 | Blue Island Ave & 18th St |           13135 | 41.85750568 | -87.64599144 | 41.85755600 | -87.66153500 |         casual |     9 |  [501907.1861189178 -1.4232159853149524E7] | [500545.77541704464 -1.4231010242258897E7] | 501907.18611892 | -1.42321599E+07 | 500545.77541704 | -1.42310102E+07 |   1781.86539868 |
| 3EF4B49FF7DAA02C |   classic_bike | 2023-04-18T07:53:51 | 2023-04-18T07:59:16 | Franklin St & Jackson Blvd |      TA1305000025 |    Clark St & Randolph St |    TA1305000030 | 41.87770796 | -87.63532114 | 41.88457623 | -87.63188991 |         casual |     7 |  [502783.1163597462 -1.4233022413426103E7] |  [503063.6502967095 -1.4233301315734675E7] | 502783.11635975 | -1.42330224E+07 | 503063.65029671 | -1.42333013E+07 |    395.58284532 |
| 210B2ED6583DC231 |   classic_bike | 2023-04-29T07:33:55 | 2023-04-29T07:38:57 |     Michigan Ave & Lake St |      TA1305000011 |    Clark St & Randolph St |    TA1305000030 | 41.88602200 | -87.62439800 | 41.88457623 | -87.63188991 |         casual |     7 |  [503715.7528127164 -1.4233861403126204E7] |  [503063.6502967095 -1.4233301315734675E7] | 503715.75281272 | -1.42338614E+07 | 503063.65029671 | -1.42333013E+07 |    859.61362107 |
| D29CB39B9E3FC46A |  electric_bike | 2023-04-18T08:00:32 | 2023-04-18T08:02:35 | Franklin St & Jackson Blvd |      TA1305000025 | Clark St & Ida B Wells Dr |    TA1305000009 | 41.87813417 | -87.63525450 | 41.87593267 | -87.63058454 |         casual |     8 | [502787.71168951405 -1.4233028887672516E7] | [503203.23756304523 -1.4233366677138694E7] | 502787.71168951 | -1.42330289E+07 | 503203.23756305 | -1.42333667E+07 |    535.50301123 |


:::



## Basic analysis and visualization


::: {.sourceClojure}
```clojure
(delay
  (-> processed-trips
      (tc/group-by [:hour])
      (tc/aggregate {:n tc/row-count})
      (tc/order-by [:hour])))
```
:::


::: {.clay-dataset}
_unnamed [24 2]:

| :hour |    :n |
|------:|------:|
|     0 |  5093 |
|     1 |  3227 |
|     2 |  1871 |
|     3 |  1162 |
|     4 |   948 |
|     5 |  2801 |
|     6 |  8859 |
|     7 | 17058 |
|     8 | 22162 |
|     9 | 17299 |
|   ... |   ... |
|    13 | 24807 |
|    14 | 25866 |
|    15 | 30699 |
|    16 | 40338 |
|    17 | 46854 |
|    18 | 38245 |
|    19 | 27078 |
|    20 | 17231 |
|    21 | 14367 |
|    22 | 10810 |
|    23 |  7317 |


:::



::: {.sourceClojure}
```clojure
(defn hour-counts-plot [trips]
  (-> trips
      (tc/group-by [:hour])
      (tc/aggregate {:n tc/row-count})
      (hanami/plot ht/bar-chart
                   {:X :hour
                    :Y :n})))
```
:::



::: {.sourceClojure}
```clojure
(delay
  (hour-counts-plot processed-trips))
```
:::



```{=html}
<div><script>vegaEmbed(document.currentScript.parentElement, {"encoding":{"y":{"field":"n","type":"quantitative"},"x":{"field":"hour","type":"quantitative"}},"usermeta":{"embedOptions":{"renderer":"svg"}},"mark":{"type":"bar","tooltip":true},"width":400,"background":"floralwhite","height":300,"data":{"url":"index_files\/0.csv","format":{"type":"csv"}}});</script></div>
```



::: {.sourceClojure}
```clojure
(defn as-geo [vega-lite-spec]
  (-> vega-lite-spec
      (update :encoding update-keys (fn [k]
                                      (get {:x :latitude
                                            :y :longitude
                                            :x2 :latitude2
                                            :y2 :longitude2}
                                           k k)))
      (assoc :projection {:type :mercator})))
```
:::



::: {.sourceClojure}
```clojure
(delay
  (-> processed-trips
      (tc/random 1000 {:seed 1})
      (hanami/plot ht/rule-chart
                   {:X :start_lat
                    :Y :start_lng
                    :X2 :end_lat
                    :Y2 :end_lng})
      as-geo))
```
:::



```{=html}
<div><script>vegaEmbed(document.currentScript.parentElement, {"encoding":{"longitude":{"field":"start_lng","type":"quantitative"},"latitude":{"field":"start_lat","type":"quantitative"},"longitude2":{"field":"end_lng","type":"quantitative"},"latitude2":{"field":"end_lat","type":"quantitative"}},"usermeta":{"embedOptions":{"renderer":"svg"}},"mark":"rule","width":400,"background":"floralwhite","projection":{"type":"mercator"},"height":300,"data":{"url":"index_files\/1.csv","format":{"type":"csv"}}});</script></div>
```



::: {.sourceClojure}
```clojure
(delay
  (-> processed-trips
      (tc/random 1000 {:seed 1})
      (hanami/plot ht/layer-chart
                   {:TITLE "Chicago bike trips"
                    :LAYER [{:data {:url "notebooks/data/chicago.geojson"
                                    :format {:type "topojson"}}
                             :mark {:type "geoshape"
                                    :filled false
                                    :clip true
                                    :opacity 0.3}}
                            (as-geo
                             (hanami/plot nil
                                          ht/rule-chart
                                          {:X :start_lat
                                           :Y :start_lng
                                           :X2 :end_lat
                                           :Y2 :end_lng
                                           :OPACITY 0.1}))]})))
```
:::



```{=html}
<div><script>vegaEmbed(document.currentScript.parentElement, {"usermeta":{"embedOptions":{"renderer":"svg"}},"width":400,"background":"floralwhite","title":{"text":"Chicago bike trips"},"layer":[{"data":{"url":"notebooks\/data\/chicago.geojson","format":{"type":"topojson"}},"mark":{"type":"geoshape","filled":false,"clip":true,"opacity":0.3}},{"encoding":{"longitude":{"field":"start_lng","type":"quantitative"},"opacity":{"value":0.1},"latitude":{"field":"start_lat","type":"quantitative"},"longitude2":{"field":"end_lng","type":"quantitative"},"latitude2":{"field":"end_lat","type":"quantitative"}},"usermeta":{"embedOptions":{"renderer":"svg"}},"mark":"rule","width":400,"background":"floralwhite","projection":{"type":"mercator"},"height":300}],"height":300,"data":{"url":"index_files\/1.csv","format":{"type":"csv"}}});</script></div>
```



## Clustering


::: {.sourceClojure}
```clojure
(def clustering
  (-> processed-trips
      (tc/select-columns coord-colnames)
      tc/rows
      (clustering/k-means 100)
      (dissoc :data)))
```
:::


Let us plot a few clusters:


::: {.sourceClojure}
```clojure
(defn as-png [vega-lite-spec]
  ;; to improve performance, we avoid rendering as SVG in this case:
  (-> vega-lite-spec
      (assoc :usermeta {:embedOptions {:renderer :png}})))
```
:::



::: {.sourceClojure}
```clojure
(delay
  (-> processed-trips
      (tc/add-column :cluster (:clustering clustering))
      (tc/group-by [:cluster])
      (tc/without-grouping->
       (tc/order-by (fn [ds]
                      (-> ds :data tc/row-count))
                    :desc)
       (tc/head 5))
      (tc/aggregate {:n tc/row-count
                     :map (fn [trips]
                            [(-> trips
                                 (hanami/plot ht/layer-chart
                                              {:TITLE "Chicago bike trips"
                                               :LAYER [{:data {:url "notebooks/data/chicago.geojson"
                                                               :format {:type "topojson"}}
                                                        :mark {:type "geoshape"
                                                               :filled false
                                                               :clip true
                                                               :opacity 0.3}}
                                                       (as-geo
                                                        (hanami/plot nil
                                                                     ht/rule-chart
                                                                     {:X :start_lat
                                                                      :Y :start_lng
                                                                      :X2 :end_lat
                                                                      :Y2 :end_lng
                                                                      :OPACITY 0.01}))
                                                       (as-geo
                                                        (hanami/plot nil
                                                                     ht/point-chart
                                                                     {:X :start_lat
                                                                      :Y :start_lng
                                                                      :MCOLOR "purple"
                                                                      :OPACITY 0.01}))
                                                       (as-geo
                                                        (hanami/plot nil
                                                                     ht/point-chart
                                                                     {:X :end_lat
                                                                      :Y :end_lng
                                                                      :MCOLOR "green"
                                                                      :OPACITY 0.01}))]})
                                 as-png)])
                     :hours (fn [trips]
                              [(hour-counts-plot trips)])})
      kind/table))
```
:::


::: {.clay-table}

```{=html}
<table class="table table-hover table-responsive"><thead><tr><th>cluster</th><th>n</th><th>map-0</th><th>hours-0</th></tr></thead><tbody><tr><td>79</td><td>12193</td><td><div><script>vegaEmbed(document.currentScript.parentElement, {"usermeta":{"embedOptions":{"renderer":"png"}},"width":400,"background":"floralwhite","title":{"text":"Chicago bike trips"},"layer":[{"data":{"url":"notebooks\/data\/chicago.geojson","format":{"type":"topojson"}},"mark":{"type":"geoshape","filled":false,"clip":true,"opacity":0.3}},{"encoding":{"longitude":{"field":"start_lng","type":"quantitative"},"opacity":{"value":0.01},"latitude":{"field":"start_lat","type":"quantitative"},"longitude2":{"field":"end_lng","type":"quantitative"},"latitude2":{"field":"end_lat","type":"quantitative"}},"usermeta":{"embedOptions":{"renderer":"svg"}},"mark":"rule","width":400,"background":"floralwhite","projection":{"type":"mercator"},"height":300},{"encoding":{"longitude":{"field":"start_lng","type":"quantitative"},"opacity":{"value":0.01},"latitude":{"field":"start_lat","type":"quantitative"}},"usermeta":{"embedOptions":{"renderer":"svg"}},"mark":{"type":"circle","color":"purple","tooltip":true},"width":400,"background":"floralwhite","projection":{"type":"mercator"},"height":300},{"encoding":{"longitude":{"field":"end_lng","type":"quantitative"},"opacity":{"value":0.01},"latitude":{"field":"end_lat","type":"quantitative"}},"usermeta":{"embedOptions":{"renderer":"svg"}},"mark":{"type":"circle","color":"green","tooltip":true},"width":400,"background":"floralwhite","projection":{"type":"mercator"},"height":300}],"height":300,"data":{"url":"index_files\/2.csv","format":{"type":"csv"}}});</script></div></td><td><div><script>vegaEmbed(document.currentScript.parentElement, {"encoding":{"y":{"field":"n","type":"quantitative"},"x":{"field":"hour","type":"quantitative"}},"usermeta":{"embedOptions":{"renderer":"svg"}},"mark":{"type":"bar","tooltip":true},"width":400,"background":"floralwhite","height":300,"data":{"url":"index_files\/3.csv","format":{"type":"csv"}}});</script></div></td></tr><tr><td>21</td><td>11476</td><td><div><script>vegaEmbed(document.currentScript.parentElement, {"usermeta":{"embedOptions":{"renderer":"png"}},"width":400,"background":"floralwhite","title":{"text":"Chicago bike trips"},"layer":[{"data":{"url":"notebooks\/data\/chicago.geojson","format":{"type":"topojson"}},"mark":{"type":"geoshape","filled":false,"clip":true,"opacity":0.3}},{"encoding":{"longitude":{"field":"start_lng","type":"quantitative"},"opacity":{"value":0.01},"latitude":{"field":"start_lat","type":"quantitative"},"longitude2":{"field":"end_lng","type":"quantitative"},"latitude2":{"field":"end_lat","type":"quantitative"}},"usermeta":{"embedOptions":{"renderer":"svg"}},"mark":"rule","width":400,"background":"floralwhite","projection":{"type":"mercator"},"height":300},{"encoding":{"longitude":{"field":"start_lng","type":"quantitative"},"opacity":{"value":0.01},"latitude":{"field":"start_lat","type":"quantitative"}},"usermeta":{"embedOptions":{"renderer":"svg"}},"mark":{"type":"circle","color":"purple","tooltip":true},"width":400,"background":"floralwhite","projection":{"type":"mercator"},"height":300},{"encoding":{"longitude":{"field":"end_lng","type":"quantitative"},"opacity":{"value":0.01},"latitude":{"field":"end_lat","type":"quantitative"}},"usermeta":{"embedOptions":{"renderer":"svg"}},"mark":{"type":"circle","color":"green","tooltip":true},"width":400,"background":"floralwhite","projection":{"type":"mercator"},"height":300}],"height":300,"data":{"url":"index_files\/4.csv","format":{"type":"csv"}}});</script></div></td><td><div><script>vegaEmbed(document.currentScript.parentElement, {"encoding":{"y":{"field":"n","type":"quantitative"},"x":{"field":"hour","type":"quantitative"}},"usermeta":{"embedOptions":{"renderer":"svg"}},"mark":{"type":"bar","tooltip":true},"width":400,"background":"floralwhite","height":300,"data":{"url":"index_files\/5.csv","format":{"type":"csv"}}});</script></div></td></tr><tr><td>32</td><td>11174</td><td><div><script>vegaEmbed(document.currentScript.parentElement, {"usermeta":{"embedOptions":{"renderer":"png"}},"width":400,"background":"floralwhite","title":{"text":"Chicago bike trips"},"layer":[{"data":{"url":"notebooks\/data\/chicago.geojson","format":{"type":"topojson"}},"mark":{"type":"geoshape","filled":false,"clip":true,"opacity":0.3}},{"encoding":{"longitude":{"field":"start_lng","type":"quantitative"},"opacity":{"value":0.01},"latitude":{"field":"start_lat","type":"quantitative"},"longitude2":{"field":"end_lng","type":"quantitative"},"latitude2":{"field":"end_lat","type":"quantitative"}},"usermeta":{"embedOptions":{"renderer":"svg"}},"mark":"rule","width":400,"background":"floralwhite","projection":{"type":"mercator"},"height":300},{"encoding":{"longitude":{"field":"start_lng","type":"quantitative"},"opacity":{"value":0.01},"latitude":{"field":"start_lat","type":"quantitative"}},"usermeta":{"embedOptions":{"renderer":"svg"}},"mark":{"type":"circle","color":"purple","tooltip":true},"width":400,"background":"floralwhite","projection":{"type":"mercator"},"height":300},{"encoding":{"longitude":{"field":"end_lng","type":"quantitative"},"opacity":{"value":0.01},"latitude":{"field":"end_lat","type":"quantitative"}},"usermeta":{"embedOptions":{"renderer":"svg"}},"mark":{"type":"circle","color":"green","tooltip":true},"width":400,"background":"floralwhite","projection":{"type":"mercator"},"height":300}],"height":300,"data":{"url":"index_files\/6.csv","format":{"type":"csv"}}});</script></div></td><td><div><script>vegaEmbed(document.currentScript.parentElement, {"encoding":{"y":{"field":"n","type":"quantitative"},"x":{"field":"hour","type":"quantitative"}},"usermeta":{"embedOptions":{"renderer":"svg"}},"mark":{"type":"bar","tooltip":true},"width":400,"background":"floralwhite","height":300,"data":{"url":"index_files\/7.csv","format":{"type":"csv"}}});</script></div></td></tr><tr><td>49</td><td>10835</td><td><div><script>vegaEmbed(document.currentScript.parentElement, {"usermeta":{"embedOptions":{"renderer":"png"}},"width":400,"background":"floralwhite","title":{"text":"Chicago bike trips"},"layer":[{"data":{"url":"notebooks\/data\/chicago.geojson","format":{"type":"topojson"}},"mark":{"type":"geoshape","filled":false,"clip":true,"opacity":0.3}},{"encoding":{"longitude":{"field":"start_lng","type":"quantitative"},"opacity":{"value":0.01},"latitude":{"field":"start_lat","type":"quantitative"},"longitude2":{"field":"end_lng","type":"quantitative"},"latitude2":{"field":"end_lat","type":"quantitative"}},"usermeta":{"embedOptions":{"renderer":"svg"}},"mark":"rule","width":400,"background":"floralwhite","projection":{"type":"mercator"},"height":300},{"encoding":{"longitude":{"field":"start_lng","type":"quantitative"},"opacity":{"value":0.01},"latitude":{"field":"start_lat","type":"quantitative"}},"usermeta":{"embedOptions":{"renderer":"svg"}},"mark":{"type":"circle","color":"purple","tooltip":true},"width":400,"background":"floralwhite","projection":{"type":"mercator"},"height":300},{"encoding":{"longitude":{"field":"end_lng","type":"quantitative"},"opacity":{"value":0.01},"latitude":{"field":"end_lat","type":"quantitative"}},"usermeta":{"embedOptions":{"renderer":"svg"}},"mark":{"type":"circle","color":"green","tooltip":true},"width":400,"background":"floralwhite","projection":{"type":"mercator"},"height":300}],"height":300,"data":{"url":"index_files\/8.csv","format":{"type":"csv"}}});</script></div></td><td><div><script>vegaEmbed(document.currentScript.parentElement, {"encoding":{"y":{"field":"n","type":"quantitative"},"x":{"field":"hour","type":"quantitative"}},"usermeta":{"embedOptions":{"renderer":"svg"}},"mark":{"type":"bar","tooltip":true},"width":400,"background":"floralwhite","height":300,"data":{"url":"index_files\/9.csv","format":{"type":"csv"}}});</script></div></td></tr><tr><td>13</td><td>10360</td><td><div><script>vegaEmbed(document.currentScript.parentElement, {"usermeta":{"embedOptions":{"renderer":"png"}},"width":400,"background":"floralwhite","title":{"text":"Chicago bike trips"},"layer":[{"data":{"url":"notebooks\/data\/chicago.geojson","format":{"type":"topojson"}},"mark":{"type":"geoshape","filled":false,"clip":true,"opacity":0.3}},{"encoding":{"longitude":{"field":"start_lng","type":"quantitative"},"opacity":{"value":0.01},"latitude":{"field":"start_lat","type":"quantitative"},"longitude2":{"field":"end_lng","type":"quantitative"},"latitude2":{"field":"end_lat","type":"quantitative"}},"usermeta":{"embedOptions":{"renderer":"svg"}},"mark":"rule","width":400,"background":"floralwhite","projection":{"type":"mercator"},"height":300},{"encoding":{"longitude":{"field":"start_lng","type":"quantitative"},"opacity":{"value":0.01},"latitude":{"field":"start_lat","type":"quantitative"}},"usermeta":{"embedOptions":{"renderer":"svg"}},"mark":{"type":"circle","color":"purple","tooltip":true},"width":400,"background":"floralwhite","projection":{"type":"mercator"},"height":300},{"encoding":{"longitude":{"field":"end_lng","type":"quantitative"},"opacity":{"value":0.01},"latitude":{"field":"end_lat","type":"quantitative"}},"usermeta":{"embedOptions":{"renderer":"svg"}},"mark":{"type":"circle","color":"green","tooltip":true},"width":400,"background":"floralwhite","projection":{"type":"mercator"},"height":300}],"height":300,"data":{"url":"index_files\/10.csv","format":{"type":"csv"}}});</script></div></td><td><div><script>vegaEmbed(document.currentScript.parentElement, {"encoding":{"y":{"field":"n","type":"quantitative"},"x":{"field":"hour","type":"quantitative"}},"usermeta":{"embedOptions":{"renderer":"svg"}},"mark":{"type":"bar","tooltip":true},"width":400,"background":"floralwhite","height":300,"data":{"url":"index_files\/11.csv","format":{"type":"csv"}}});</script></div></td></tr></tbody></table>
```

:::



```{=html}
<div style="background-color:grey;height:2px;width:100%;"></div>
```



```{=html}
<div><pre><small><small>source: <a href="https://github.com/scicloj/clojure-data-scrapbook/blob/main/projects/geography/chicago-bikes/notebooks/index.clj">projects/geography/chicago-bikes/notebooks/index.clj</a></small></small></pre></div>
```
